<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude Code で複数プロジェクトに分けて DevRag（RAG）を使う方法 - yasukoga</title>
    <meta name="description" content="Claude Code で複数プロジェクトに分けて DevRag（RAG）を使う方法">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+1:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <header>
        <nav>
            <div class="container">
                <h1 class="logo">yasukoga</h1>
                <ul class="nav-links">
                    <li><a href="../../index.html">Home</a></li>
                    <li><a href="../../index.html#about">About</a></li>
                    <li><a href="../../index.html#skills">Skills</a></li>
                    <li><a href="../../index.html#contact">Contact</a></li>
                    <li><a href="../index.html">Blog</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <main>
        <article id="blog-post">
            <div class="container">
                <div class="post-header">
                    <h1 class="post-title">Claude Code で複数プロジェクトに分けて DevRag（RAG）を使う方法</h1>
                    <div class="post-meta">
                        <time datetime="2025-12-28">2025年12月28日</time>
                        <div class="post-tags">
                            <span class="tag">AI</span><span class="tag">PM</span>
                        </div>
                    </div>
                </div>
                <div class="post-content">
                    <h1>Claude Code で複数プロジェクトに分けて DevRag（RAG）を使う方法</h1>
<p>Claude Code に RAG を導入できる DevRag ですが、複数のプロジェクトを扱う場合は注意が必要です。デフォルト設定のままだと、違うプロジェクトのドキュメントが検索結果に混ざってしまう可能性があります。</p>
<p>この記事では、プロジェクトごとに DevRag を分離して設定する方法をまとめます。</p>
<h2>前提知識</h2>
<h3>DevRag とは</h3>
<p>DevRag は Claude Code 用の無料 RAG ツールです。ドキュメントをベクトル検索できるようになり、Claude Code が自動で関連情報を見つけてくれます。</p>
<p>詳しくは：<a href="https://zenn.dev/abalol/articles/claude-code-rag">Claude Code に無料の RAG 導入でトークン＆時間節約</a></p>
<h3>MCP のスコープ</h3>
<p>Claude Code の MCP 設定には 3 つのスコープがあります。</p>
<table>
<thead>
<tr>
<th>スコープ</th>
<th>設定ファイル</th>
<th>影響範囲</th>
</tr>
</thead>
<tbody><tr>
<td><code>local</code></td>
<td><code>~/.claude.json</code>（プロジェクトパス配下）</td>
<td>そのプロジェクトのみ（個人用）</td>
</tr>
<tr>
<td><code>project</code></td>
<td><code>.mcp.json</code>（プロジェクトルート）</td>
<td>そのプロジェクトのみ（チーム共有可）</td>
</tr>
<tr>
<td><code>user</code></td>
<td><code>~/.claude.json</code></td>
<td>全プロジェクト共通</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>注</strong>: 優先順位は <code>local</code> &gt; <code>project</code> &gt; <code>user</code> の順です。</p>
</blockquote>
<h2>問題：グローバル設定だと情報が混ざる</h2>
<p>よくある設定例（これだと問題あり）：</p>
<pre><code class="language-json">// ~/.claude.json（グローバル設定）
{
  &quot;mcpServers&quot;: {
    &quot;devrag&quot;: {
      &quot;command&quot;: &quot;devrag&quot;
    }
  }
}
</code></pre>
<p>この設定だと、DevRag はデフォルトの <code>./documents</code>（カレントディレクトリ配下の documents フォルダ）を検索します。どのプロジェクトで Claude Code を起動しても同じ設定が使われるため、プロジェクト固有の設定ができません。</p>
<pre><code>project-a/ で起動 → ./documents を検索
project-b/ で起動 → ./documents を検索

→ 各プロジェクトに documents/ があれば分離されるが、
   config.json の細かい設定（chunk_size 等）を変えられない
</code></pre>
<h2>解決策：プロジェクトごとに .mcp.json と config.json を作る</h2>
<p>各プロジェクトのルートに <code>.mcp.json</code> と <code>config.json</code> を作成し、そのプロジェクト専用の設定を書きます。</p>
<h3>ディレクトリ構成</h3>
<pre><code>~/projects/
├── project-a/
│   ├── .mcp.json           ← project-a 用の MCP 設定
│   ├── config.json         ← project-a 用の DevRag 設定
│   ├── documents/          ← project-a のドキュメント
│   │   ├── api-spec.md
│   │   └── architecture.md
│   └── src/
│
└── project-b/
    ├── .mcp.json           ← project-b 用の MCP 設定
    ├── config.json         ← project-b 用の DevRag 設定
    ├── documents/          ← project-b のドキュメント
    │   ├── requirements.md
    │   └── design.md
    └── src/
</code></pre>
<h3>設定方法</h3>
<h4>方法 1: コマンドで設定</h4>
<p>各プロジェクトのディレクトリに移動して、<code>--scope project</code> オプションで設定します。</p>
<pre><code class="language-bash"># project-a の設定
cd ~/projects/project-a
claude mcp add devrag --scope project -- /usr/local/bin/devrag

# project-b の設定
cd ~/projects/project-b
claude mcp add devrag --scope project -- /usr/local/bin/devrag
</code></pre>
<blockquote>
<p><strong>注</strong>: <code>-s</code> は <code>--scope</code> の短縮形として使える場合があります。</p>
</blockquote>
<h4>方法 2: 設定ファイルを直接作成</h4>
<p>各プロジェクトのルートに <code>.mcp.json</code> を作成します。</p>
<pre><code class="language-json">// ~/projects/project-a/.mcp.json
{
  &quot;mcpServers&quot;: {
    &quot;devrag&quot;: {
      &quot;type&quot;: &quot;stdio&quot;,
      &quot;command&quot;: &quot;/usr/local/bin/devrag&quot;
    }
  }
}
</code></pre>
<p>そして、同じディレクトリに <code>config.json</code> を作成して DevRag の設定を行います。</p>
<pre><code class="language-json">// ~/projects/project-a/config.json
{
  &quot;documents_dir&quot;: &quot;./documents&quot;,
  &quot;db_path&quot;: &quot;./vectors.db&quot;,
  &quot;chunk_size&quot;: 500,
  &quot;search_top_k&quot;: 5,
  &quot;compute&quot;: {
    &quot;device&quot;: &quot;auto&quot;,
    &quot;fallback_to_cpu&quot;: true
  },
  &quot;model&quot;: {
    &quot;name&quot;: &quot;multilingual-e5-small&quot;,
    &quot;dimensions&quot;: 384
  }
}
</code></pre>
<p>project-b も同様に設定します。</p>
<h3>動作確認</h3>
<pre><code class="language-bash">cd ~/projects/project-a
claude

&gt; /mcp
MCP Servers:
✓ devrag (connected)    ← project-a の documents/ を検索
</code></pre>
<p>別のプロジェクトでも確認：</p>
<pre><code class="language-bash">cd ~/projects/project-b
claude

&gt; /mcp
MCP Servers:
✓ devrag (connected)    ← project-b の documents/ を検索
</code></pre>
<h2>応用：共通ドキュメントとプロジェクト固有を併用</h2>
<p>会社共通のドキュメント（コーディング規約など）と、プロジェクト固有のドキュメントを両方使いたい場合。</p>
<h3>方法: シンボリックリンク</h3>
<p>共通ドキュメントをシンボリックリンクで各プロジェクトに配置：</p>
<pre><code class="language-bash">ln -s ~/shared-docs ~/projects/project-a/documents/shared
ln -s ~/shared-docs ~/projects/project-b/documents/shared
</code></pre>
<pre><code>project-a/
└── documents/
    ├── api-spec.md          ← プロジェクト固有
    └── shared/ → ~/shared-docs  ← 共通（シンボリックリンク）
</code></pre>
<p>DevRag は <code>documents_dir</code> 配下を再帰的にインデックス化するため、シンボリックリンク先のファイルも検索対象になります。</p>
<blockquote>
<p><strong>注</strong>: DevRag は stdio 方式の MCP サーバーとして動作するため、ポート番号を指定して複数インスタンスを起動する方法は使用できません。プロジェクトごとに分離したい場合は、上記のようにプロジェクトごとの <code>config.json</code> で <code>documents_dir</code> を設定してください。</p>
</blockquote>
<h2>Git での管理</h2>
<p><code>.mcp.json</code> をリポジトリに含めるかどうかは、チームの方針次第です。</p>
<h3>含める場合（チームで共有）</h3>
<pre><code class="language-json">// .mcp.json（コミットする）
{
  &quot;mcpServers&quot;: {
    &quot;devrag&quot;: {
      &quot;type&quot;: &quot;stdio&quot;,
      &quot;command&quot;: &quot;devrag&quot;
    }
  }
}
</code></pre>
<p>チームメンバーも同じ設定で使えます。ただし、全員が DevRag をインストールしている必要があります。</p>
<h3>含めない場合（個人設定）</h3>
<pre><code class="language-gitignore"># .gitignore
.mcp.json
config.json
vectors.db
</code></pre>
<p>個人の好みで MCP を設定できます。</p>
<h2>トラブルシューティング</h2>
<h3>「違うプロジェクトの情報が出てくる」</h3>
<p>グローバル設定（<code>~/.claude.json</code>）に DevRag が登録されている可能性があります。</p>
<pre><code class="language-bash"># グローバル設定を確認
claude mcp list

# 不要なグローバル設定を削除
claude mcp remove devrag --scope user
</code></pre>
<h3>「MCP が接続されない」</h3>
<ol>
<li>DevRag がインストールされているか確認</li>
</ol>
<pre><code class="language-bash">which devrag
# /usr/local/bin/devrag
</code></pre>
<ol start="2">
<li><p><code>.mcp.json</code> の場所を確認（プロジェクトルートに置く）</p>
</li>
<li><p>Claude Code を再起動</p>
</li>
</ol>
<h3>「documents/ が見つからない」</h3>
<p><code>config.json</code> の <code>documents_dir</code> に指定したパスが存在するか確認：</p>
<pre><code class="language-bash">ls ./documents/
</code></pre>
<h3>「project スコープのサーバーが claude mcp list に表示されない」</h3>
<p>これは Claude Code の既知の動作です。project スコープのサーバーは <code>claude mcp list</code> には表示されませんが、正常に動作します。</p>
<pre><code class="language-bash"># 個別に確認する場合
claude mcp get devrag
</code></pre>
<h2>まとめ</h2>
<table>
<thead>
<tr>
<th>やりたいこと</th>
<th>設定方法</th>
</tr>
</thead>
<tbody><tr>
<td>プロジェクトごとに分離</td>
<td><code>.mcp.json</code> と <code>config.json</code> を各プロジェクトに作成</td>
</tr>
<tr>
<td>検索対象フォルダを指定</td>
<td><code>config.json</code> の <code>documents_dir</code> で設定</td>
</tr>
<tr>
<td>グローバル設定を避ける</td>
<td><code>--scope project</code> でプロジェクト単位に設定</td>
</tr>
<tr>
<td>共通ドキュメントも使う</td>
<td>シンボリックリンクを使用</td>
</tr>
</tbody></table>
<p>ポイントは <strong>グローバル設定（<code>~/.claude.json</code>）ではなく、プロジェクトごとの設定（<code>.mcp.json</code> + <code>config.json</code>）を使う</strong> ことです。</p>
<p>これで、複数のプロジェクトを扱っても情報が混ざらず、安心して DevRag を活用できます。</p>
<hr>
<h2>変更履歴・訂正箇所</h2>
<p>この記事は元記事から以下の点を修正しています：</p>
<ol>
<li><strong>MCP スコープの数</strong>: 2 つ → 3 つ（<code>local</code>, <code>project</code>, <code>user</code>）に訂正</li>
<li><strong>デフォルトディレクトリ</strong>: <code>~/documents/</code> → <code>./documents</code>（相対パス）に訂正</li>
<li><strong><code>--port</code> オプション</strong>: DevRag は stdio 方式の MCP サーバーであり、ポート指定オプションは存在しないため削除</li>
<li><strong>複数インスタンスの方法</strong>: ポート指定による複数起動 → <code>config.json</code> による設定分離に変更</li>
<li><strong>設定方法</strong>: コマンドライン引数 <code>--docs-dir</code> → <code>config.json</code> での設定に変更（DevRag は設定ファイルベース）</li>
</ol>

                </div>
                <div class="post-footer">
                    <a href="../index.html" class="back-to-list">← ブログ一覧に戻る</a>
                </div>
            </div>
        </article>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 yasukoga. All rights reserved.</p>
        </div>
    </footer>
</body>
</html>
